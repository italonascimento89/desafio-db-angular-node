# Desafio Vota√ß√£o ‚Äî Backend Node.js

## Vis√£o Geral

Este projeto representa o backend da aplica√ß√£o de vota√ß√£o, desenvolvido em Node.js com arquitetura modular e suporte a ES Modules. Ele √© respons√°vel por gerenciar as regras de neg√≥cio, persist√™ncia de dados e comunica√ß√£o com o frontend via API REST.

A aplica√ß√£o permite o cadastro de pautas, abertura de sess√µes de vota√ß√£o, registro de votos por CPF √∫nico e apura√ß√£o dos resultados. Toda a comunica√ß√£o √© feita em formato JSON, e a documenta√ß√£o da API est√° dispon√≠vel via Swagger.

---

## Pr√©-requisitos

Antes de iniciar, certifique-se de que os seguintes softwares estejam instalados em sua m√°quina:

- Node.js (vers√µes compat√≠veis: ^18.19.1, ^20.11.1 ou ^22.0.0)
- Docker e Docker Compose (necess√°rios para subir o banco de dados via container)

---

## Tecnologias Utilizadas

- Node.js (vers√µes compat√≠veis: ^18.19.1, ^20.11.1 ou ^22.0.0)
- Express para gerenciamento de rotas e middlewares
- Sequelize como ORM para PostgreSQL
- dotenv para gerenciamento de vari√°veis de ambiente
- Swagger para documenta√ß√£o da API
- Jest e Supertest para testes automatizados
- Babel para suporte a ES Modules e transpila√ß√£o

---

## Instala√ß√£o e Execu√ß√£o

Antes de iniciar, certifique-se de que voc√™ possui uma vers√£o compat√≠vel do Node.js instalada em sua m√°quina.

Para executar o projeto localmente, siga os seguintes passos:

1. Fa√ßa o clone do reposit√≥rio em sua m√°quina.
2. Acesse o diret√≥rio correspondente ao backend.
3. Execute o Docker Compose

```bash
docker-compose up -d
```

4. Instale todas as depend√™ncias utilizando o gerenciador de pacotes

```bash
npm install
```

5. Execute o comando de migra√ß√£o para criar as tabelas no banco de dados utilizando o comando: npm run migrate

```bash
 npm run migrate
```

6. Inicie o servidor da aplica√ß√£o

```bash
 npm start
```

---

## Usu√°rios Cadastrados no Sistema

O sistema j√° est√° pr√©-configurado com dois usu√°rios para fins de teste e valida√ß√£o das funcionalidades:

### Admin  
CPF: `659.652.350-03`  
Este usu√°rio possui permiss√µes administrativas, como cria√ß√£o de pautas e abertura de sess√µes de vota√ß√£o.

### Votante  
CPF: `536.833.990-90`  
Este usu√°rio pode participar das vota√ß√µes, registrando seu voto em pautas abertas.

Esses CPFs podem ser utilizados diretamente nas requisi√ß√µes para simular os fluxos de vota√ß√£o e administra√ß√£o.

---

## Endpoints da API

Ap√≥s iniciar o servidor backend, voc√™ ver√° no console:

API rodando em http://localhost:3000  
Swagger dispon√≠vel em http://localhost:3000/api-docs

---

## Testes Automatizados

O backend inclui testes automatizados que validam regras de neg√≥cio, rotas e integra√ß√µes com o banco de dados. Os testes foram escritos com Jest e Supertest.

Para executar os testes, utilize o comando de teste padr√£o definido no projeto. Basta rodar "npm run test" no terminal. Isso iniciar√° o ambiente de testes e exibir√° os resultados diretamente no console.

Os testes cobrem cen√°rios como:

- Cadastro e listagem de pautas
- Abertura e encerramento de sess√µes de vota√ß√£o
- Registro de votos com valida√ß√£o de CPF e unicidade
- Apura√ß√£o e retorno do resultado da vota√ß√£o

Executar testes:

```bash
npm run test
```

---

## Endpoints Principais

A API REST exp√µe os seguintes recursos:

- Cadastro de pauta
- Abertura de sess√£o de vota√ß√£o
- Registro de voto (Sim/N√£o)
- Consulta de resultado da pauta
- Listagem de pautas com sess√µes abertas

Todos os endpoints aceitam e retornam dados em formato JSON. A documenta√ß√£o completa est√° dispon√≠vel via Swagger na rota padr√£o `/api-docs`.

---

## Boas Pr√°ticas Adotadas

- Separa√ß√£o clara entre camadas de controller, service e repository
- Tratamento de erros centralizado
- Uso de UUID para identifica√ß√£o √∫nica de registros
- Persist√™ncia segura e dur√°vel dos dados com Sequelize
- Testes automatizados com cobertura m√≠nima recomendada
- Documenta√ß√£o da API gerada automaticamente com Swagger

---

## üìå Rotas da API

### Categorias

- `POST /v1/categorias`  
  Cria uma nova categoria.  
  Requer o campo `nome` no corpo da requisi√ß√£o.  
  Retornos:
  - 201: Categoria criada com sucesso
  - 400: Categoria inv√°lida
  - 409: Categoria j√° cadastrada

- `GET /v1/categorias`  
  Lista todas as categorias cadastradas.  
  Retorno:
  - 200: Lista de categorias no formato JSON

---

### Pautas

- `POST /v1/pautas`  
  Cria uma nova pauta.  
  Requer os campos `nome` e `id_admin`.  
  Campos opcionais: `categoria`, `descricao`, `tempo_aberta`  
  Retornos:
  - 201: Pauta criada com sucesso
  - 400: Dados inv√°lidos
  - 409: Conflito de cadastro

- `GET /v1/pautas`  
  Lista todas as pautas com suporte a filtros e pagina√ß√£o.  
  Par√¢metros opcionais:
  - `categoria`: filtra por categoria da pauta
  - `status`: aberta, encerrada ou todas
  - `page`: n√∫mero da p√°gina
  - `limit`: quantidade de itens por p√°gina  
  Retorno:
  - 200: Lista paginada de pautas

- `GET /v1/pautas/{id}`  
  Busca os detalhes de uma pauta espec√≠fica pelo seu ID.  
  Retornos:
  - 200: Detalhes da pauta
  - 404: Pauta n√£o encontrada

---

### Usu√°rios

- `POST /v1/users/admin`  
  Cria um novo usu√°rio administrador.  
  Requer o campo `cpf` no corpo da requisi√ß√£o.  
  Retornos:
  - 201: Usu√°rio criado com sucesso
  - 400: CPF ou tipo inv√°lido
  - 409: CPF j√° cadastrado

- `POST /v1/users/voters`  
  Cria um novo usu√°rio votante.  
  Requer os campos `cpf` e `id_admin` no corpo da requisi√ß√£o.  
  Retornos:
  - 201: Usu√°rio criado com sucesso
  - 400: CPF ou tipo inv√°lido
  - 409: CPF j√° cadastrado

- `GET /v1/users`  
  Lista todos os usu√°rios cadastrados.  
  Retorno:
  - 200: Lista de usu√°rios no formato JSON

- `GET /v1/users/{cpf}`  
  Busca um usu√°rio espec√≠fico pelo CPF.  
  Retornos:
  - 200: Usu√°rio encontrado
  - 400: CPF inv√°lido
  - 404: Usu√°rio n√£o encontrado

---

### Votos

- `POST /v1/votos`  
  Registra um voto em uma pauta.  
  Requer os campos `cpf`, `id_pauta` e `voto` no corpo da requisi√ß√£o.  
  O campo `voto` deve ser `"sim"` ou `"nao"`.  
  Retornos:
  - 201: Voto registrado com sucesso
  - 400: Pauta encerrada ou dados inv√°lidos
  - 404: Usu√°rio ou pauta n√£o encontrados
  - 409: Usu√°rio j√° votou nessa pauta

- `GET /v1/votos/resultado/{idPauta}`  
  Retorna o resultado da vota√ß√£o de uma pauta espec√≠fica.  
  Requer o par√¢metro `idPauta` no caminho da URL.  
  Retornos:
  - 200: Resultado da vota√ß√£o com totais, porcentagens e status da sess√£o
  - 404: Pauta n√£o encontrada
